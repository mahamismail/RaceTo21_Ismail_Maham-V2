@page "/Gameplay"
@using RaceTo21_BlazorApp

@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime

<style>

	body {
		font-family: 'Montserrat', sans-serif;
	}

	.fixed-bottom {
		justify-content: center;
	}

	.row {
		display: flex;
		flex-wrap: wrap;
		justify-content: space-between;
		align-items: center;
		width: 100%;
	}

	.btn-purple {
		background-color: purple;
		color: #fff; /* text color */
	}

	.btn-rounded {
		border-radius: 50px; /* make the button fully rounded */
		padding: 10px 20px; /* adjust the padding to your preference */
		font-size: 16px; /* adjust the font size to your preference */
		font-weight: 500;
	}

	#numberInput {
		background-color: #D3D3D3; /* set the background color to grey */
		width: 200px; /* set the width to your desired size */
		margin: 20px;
		font-size: 20px;
		font-weight: bold;
		text-align: center;
	}

	.form-group {
		margin: 10px;
		display: inline-block;
	}

	.form-control {
		background-color: #D3D3D3; /* set the background color to grey */
		width: 200px; /* set the width to your desired size */
		font-size: 20px;
		font-weight: bold;
		text-align: center;
		padding: 10px;
	}

	p {
		width: 70%;
		text-align: center;
		padding-bottom: 20px;
	}

	.nav {
		padding: 30px;
		display: flex;
		width: 100%;
		max-width: 100%;
	}

	.container {
		padding: 0 0 80px 0;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
	}

	.greyNav {
		background-color: #CBC3E3;
	}

	h2 {
		padding: 10px 10px 10px 10px;
		font-size: 30px;
		font-weight: bold;
		text-align: center;
		margin-top: 10px;
	}

	.card-container {
		display: flex;
		flex-wrap: wrap;
		justify-content: flex-start;
	}

	.card-image {
		max-width: 120%;
		margin-right: -45px;
	}

	.purple-outline {
		border-style: solid;
		border: 2px solid;
		border-color: purple;
	}

	.purple-solid {
		background-color: purple;
		border: 2px solid;
		border-color: purple;
	}

	.green-solid {
		background-color: #50C878;
		color: white;
		border: 2px solid;
		border-color: #50C878;
	}

	.grey-solid {
		background-color: #D3D3D3;
		color: black;
		border: 2px solid; 
		border-color: #D3D3D3;
	}

	.purple-text {
		color: purple;
	}
</style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

<div class="container column" id="playerList" style="align-items: center; margin: auto">
	@switch (Game.nextTask)
	{
		case AllTasks.PlayerTurn:

			<h2 class="mt-4" style="margin-bottom: 10px;">Round @(Game.rounds+1)</h2>
			<div class="col" style="display: flex; justify-content: center; margin-bottom: 20px;">
				<p>Score exactly 21 points or the highest possible <br /> number under 21 to win this round!</p>
			</div>
			<div style="margin-bottom: 10px; display: flex; flex-direction: column; align-items: flex-start;">
				@foreach (Player player in Game.players)
				{
					@if (player.isWinner == true)
					{
						DisableButtons();
						<div class="col" style="display: flex; justify-content: center; margin-bottom: 20px;">
							<h4 style="font-weight: 400; margin-right: 20px; ">🎊 ~ <b>@player.name</b> wins! ~ 🎊</h4>
							<button type="button" class="btn btn-purple btn-rounded" @onclick="() => { Game.nextTask = AllTasks.ShowOverallScores; GoToOverallScore(); }">View Scores</button>
						</div>
					}
				}

				@foreach (Player player in Game.players)
				{
					<div id="Player@(Game.players.IndexOf(player))" style="flex-direction: row; flex-wrap: nowrap; justify-content: flex-start; margin: 10px 30px 0 30px; display: inline-block;">
						<label class="@(player.isCurrentPlayer || player.isWinner ? "purple-text" : " ")" style="font-weight: bold; font-size: 20px">@player.name</label>
						<div style="display:flex; flex-direction: row; justify-content: flex-start; align-items: center;">
							<div class="row mt-12 card-container @ContainerColor(player)" style="padding: 10px; height: 90px; width: 600px; margin-right: 10px">
								@foreach (Card card in player.cards)
								{
									<img class="card-image" src="card_assets/@Deck.imageIDs[$"{card.id}"]" alt="@card.id" />
								}
							</div>
							<h3 style="margin-right: 10px; display: inline-block; border: 2px solid; padding: 10px; border-radius: 100px ">@player.score</h3>
							<h4 class="@ContainerColor(player)" style="margin-left:20px; font-weight: 400; padding: 10px; border-radius: 10px">@PlayerStatusToString(player)</h4>
						</div>
					</div>
				}
			</div>

			<div class="fixed-bottom">
				<div class="nav greyNav">
					<row class="row">
						<div class="col-md-3">
							<label for="playerName" style="font-weight: bold; font-size: 20px">@Game.players[Game.currentPlayer].name's Turn</label>
						</div>
						<div style="display:flex; flex-direction: row; justify-items: flex-end; align-items: center;">
							<button type="button" id="drawCard1" class="btn btn-purple btn-rounded" style="margin-left: 10px" @onclick="() => { Game.DrawCards(1); /*UpdatePlayerList();*/ }" disabled="@buttonDisabled">PICK 1 CARD</button>
							<button type="button" id="drawCard2" class="btn btn-purple btn-rounded" style="margin-left: 10px" @onclick="() => { Game.DrawCards(2); /*UpdatePlayerList();*/  }" disabled="@buttonDisabled">PICK 2 CARDS</button>
							<button type="button" id="drawCard3" class="btn btn-purple btn-rounded" style="margin-left: 10px" @onclick="() => { Game.DrawCards(3); /*UpdatePlayerList();*/  }" disabled="@buttonDisabled">PICK 3 CARDS</button>
							<label style="margin-left: 10px; margin-right: 10px;">OR</label>
							<button class="btn btn-purple btn-rounded" id="drawCard0" style="width: 200px" @onclick="() => { Game.DrawCards(0); }" disabled="@buttonDisabled">PASS</button>

							<button type="button" class="btn btn-white btn-rounded mt-2" style="color:purple; " @onclick="LeaveGame">
								← Leave Game
							</button>
						</div>
					</row>
				</div>
			</div>

			break;
	}
</div>

@code {

	bool buttonDisabled = false;

	private void LeaveGame()
	{

		NavigationManager.NavigateTo("/");
	}

	private void GoToOverallScore()
	{
		NavigationManager.NavigateTo("/OverallScore");
	}

	private void DisableButtons()
	{
		buttonDisabled = true;
	}

	private void UpdatePlayerList()
	{
		foreach (Player player in Game.players)
		{
			if (player.isCurrentPlayer == true)
			{
				StateHasChanged();
			}
		}

		JSRuntime.InvokeVoidAsync("scrollToPlayerList");
	}

	private async Task ScrollToPlayerList()
	{
		await JSRuntime.InvokeVoidAsync("scrollToElement", "playerList");
	}

	private string ContainerColor(Player player)
	{
		if (player.isWinner == true)
		{
			return "green-solid";
		}
		else if (player.status == PlayerStatus.bust || player.status == PlayerStatus.stay)
		{
			return "grey-solid";
		}
		else if (player.isCurrentPlayer == true && player.status == PlayerStatus.active)
		{
			return "purple-solid";
		}
		else if (player.isCurrentPlayer == true && player.status == PlayerStatus.tie)
		{
			return "grey-solid";
		}

		return "purple-outline";
	}

	private string PlayerStatusToString(Player player)
	{
		if (player.status == PlayerStatus.bust)
		{
			return "Busted";
		}
		else if (player.status == PlayerStatus.stay)
		{
			return "Stayed";
		}
		else if (player.status == PlayerStatus.win)
		{
			return "Winner!";
		}
		else if (player.status == PlayerStatus.stay)
		{
			return "Stayed";
		}
		return "";
	}
}
